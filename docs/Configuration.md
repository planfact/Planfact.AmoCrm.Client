# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ç–∏–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

Planfact.AmoCrm.Client –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É OAuth 2.0 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–ª—é—á–µ–π.
–°–æ—Å—Ç–∞–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `access_token` –∏ `refresh_token` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
Planfact.AmoCrm.Client –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 2 –≤–∏–¥–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ - —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é.

> üìñ –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- [amoCRM OAuth 2.0](https://www.amocrm.ru/developers/content/oauth/oauth);
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](https://www.amocrm.ru/developers/content/crm_platform/platform-abilities).

### 1. –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º –≤ amoCRM –ø–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º redirect URI, –∫–æ–¥—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–æ–º–µ–Ω—É.

```csharp
var options = new AmoCrmClientOptions
{
    ClientId = "YOUR_CLIENT_ID",
    ClientSecret = "YOUR_CLIENT_SECRET",
    ServerIntegrationRedirectUri = "YOUR_REDIRECT_URI",   // URI –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –õ–ö amoCRM
    ServerIntegrationAuthCode = "YOUR_AUTH_CODE"   // –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏,
    ServerIntegrationSubdomain = "YOUR_SUBDOMAIN"  // –ø–æ–¥–¥–æ–º–µ–Ω –∞–∫–∞—É–Ω—Ç–∞, —Å –∫–æ—Ç–æ—Ä—ã–º —Å–≤—è–∑–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
};
```

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç—ã, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ amoCRM
–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```csharp
var options = new AmoCrmClientOptions
{
    ClientId = "YOUR_CLIENT_ID",
    ClientSecret = "YOUR_CLIENT_SECRET",
    WidgetCode = "YOUR_WIDGET_CODE",  // –ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ amoCRM
    WidgetApiKeyFieldName = "YOUR_WIDGET_API_KEY_FIELD",  // –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –∫–ª—é—á–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –≤–∏–¥–∂–µ—Ç–µ
    WidgetCallbackPath = "/api/v1/amocrm/oauth/webhook"  // –ü—É—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
};
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### AmoCrmClientOptions

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ API amoCRM. –ù–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç `HttpClientOptions` –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

–ö–ª–∞—Å—Å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ API amoCRM, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `HttpClientOptions`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä                          | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                                 |
|-----------------------------------|--------------------------------------------------------------------------|-------------------------------------------   |
| **ClientId**                      | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è OAuth (Integration ID)          | -                                            |
| **ClientSecret**                  | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è OAuth (Secret key)             | -                                            |
| **WidgetCode**                    | –ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç—ã amoCRM                          | -                                            |
| **WidgetApiKeyFieldName**         | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –≤–∏–¥–∂–µ—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è API-–∫–ª—é—á–∞                             | -                                            |
| **WidgetCallbackPath**            | –ü—É—Ç—å –¥–ª—è OAuth callback –æ—Ç –≤–∏–¥–∂–µ—Ç–æ–≤                                      | /api/v1/amocrmIntegrationWidget/OAuthWebhook |
| **ServerIntegrationRedirectUri**  | URI –¥–ª—è OAuth redirect –ø—Ä–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏                          | -                                            |
| **ServerIntegrationAuthCode**     | –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏                                 | -                                            |
| **ServerIntegrationSubdomain**    | –ü–æ–¥–¥–æ–º–µ–Ω amoCRM –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏                                 | -                                            |
| **OAuthTokenPath**                | –ü—É—Ç—å –∫ OAuth token endpoint                                              | oauth2/access_token                          |
| **BaseApiPath**                   | –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è API v4 endpoints                                        | api/v4                                       |
| **LeadsApiPath**                  | –ü—É—Ç—å –∫ API —Å–¥–µ–ª–æ–∫                                                        | api/v4/leads                                 |
| **CustomersApiPath**              | –ü—É—Ç—å –∫ API –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π                                                   | api/v4/customers                             |
| **AccountsApiPath**               | –ü—É—Ç—å –∫ API –∞–∫–∫–∞—É–Ω—Ç–∞                                                      | api/v4/account                               |
| **TasksApiPath**                  | –ü—É—Ç—å –∫ API –∑–∞–¥–∞—á                                                         | api/v4/tasks                                 |
| **CompaniesApiPath**              | –ü—É—Ç—å –∫ API –∫–æ–º–ø–∞–Ω–∏–π                                                      | api/v4/companies                             |
| **WidgetsApiPath**                | –ü—É—Ç—å –∫ API –≤–∏–¥–∂–µ—Ç–æ–≤                                                      | api/v4/widgets                               |
| **UsersApiPath**                  | –ü—É—Ç—å –∫ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                                                 | api/v4/users                                 |
| **ContactsApiPath**               | –ü—É—Ç—å –∫ API –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤                                                     | api/v4/contacts                              |
| **TransactionsApiPath**           | –ü—É—Ç—å –∫ API —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π                                                    | api/v4/customers/transactions                |
| **PipelinesApiPath**              | –ü—É—Ç—å –∫ API –≤–æ—Ä–æ–Ω–æ–∫                                                       | api/v4/leads/pipelines                       |
| **CustomFieldsApiResourceName**   | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤ API amoCRM                       | custom_fields                                |
| **TransactionsApiResourceName**   | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ API amoCRM                                 | transactions                                 |
| **NotesApiResourceName**          | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π –≤ API amoCRM                                 | notes                                        |
| **CacheExpiryMinutes**            | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö (–¥–ª—è `CachedAmoCrmClient`)                    | 10                                           |
| **MaxCacheSize**                  | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ –≤ –∑–∞–ø–∏—Å—è—Ö (–¥–ª—è `CachedAmoCrmClient`)            | 1000                                         |
| **UserAgent**                     | User-Agent –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤                                             | AmoCrm-DotNet-Client/1.0                     |
| **TimeoutSeconds**                | –¢–∞–π–º–∞—É—Ç HTTP-–∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö                                          | 120                                          |

---

> üìñ –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Å–º. –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ: `src/Planfact.AmoCrm.Client/AmoCrmClientOptions.cs`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ASP.NET Core

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```csharp
// Program.cs
builder.Services.AddAmoCrmClient(builder.Configuration);

// appsettings.json
{
  "AmoCrmClientOptions": {
    "ClientId": "YOUR_CLIENT_ID",
    "ClientSecret": "YOUR_CLIENT_SECRET",
    "ServerIntegrationSubdomain": "YOUR_SUBDOMAIN"
  }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º HTTP-–æ—Ç–≤–µ—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è):

```csharp
// Program.cs
builder.Services.AddCachedAmoCrmClient(builder.Configuration);

// appsettings.json
{
  "AmoCrmClientOptions": {
    "ClientId": "YOUR_CLIENT_ID",
    "ClientSecret": "YOUR_CLIENT_SECRET",
    "ServerIntegrationSubdomain": "YOUR_SUBDOMAIN",
    "CacheExpiryMinutes": 10,
    "MaxCacheSize": 1000
  }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º HttpClient

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `HttpClient` —á–µ—Ä–µ–∑ `AddAmoCrmClient` –∏–ª–∏ `AddCachedAmoCrmClient`:

```csharp
// HttpClient –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å:
// - Timeout: 120 —Å–µ–∫—É–Ω–¥ (–∏–ª–∏ –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ TimeoutSeconds)
// - User-Agent: AmoCrm-DotNet-Client/1.0 (–∏–ª–∏ –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ UserAgent)
// - Resilience: retry policies, circuit breaker, exponential backoff
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥

### Development

```json
{
  "AmoCrmClientOptions": {
    "ClientId": "dev-client-id",
    "ClientSecret": "dev-client-secret",
    "ServerIntegrationSubdomain": "dev-subdomain",
    "TimeoutSeconds": 30,
    "CacheExpiryMinutes": 5
  }
}
```

### Production

```json
{
  "AmoCrmClientOptions": {
    "ClientId": "prod-client-id",
    "ClientSecret": "prod-client-secret",
    "ServerIntegrationSubdomain": "prod-subdomain",
    "TimeoutSeconds": 120,
    "CacheExpiryMinutes": 10,
    "MaxCacheSize": 1000
  }
}
```

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

`AddCachedAmoCrmClient` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö GET –∏ HEAD –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–∏–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º:
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`oauth2/access_token`)
- –ê–∫–∫–∞—É–Ω—Ç (`api/v4/account`)
- –í–∏–¥–∂–µ—Ç—ã (`api/v4/widgets`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`api/v4/users`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–ª—è (`/custom_fields`)
- –í–æ—Ä–æ–Ω–∫–∏ (`/pipelines`)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—ç—à–∞

- **TTL**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `CacheExpiryMinutes` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 –º–∏–Ω—É—Ç)
- **–†–∞–∑–º–µ—Ä –∫—ç—à–∞**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MaxCacheSize` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1000 –∑–∞–ø–∏—Å–µ–π)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ `MemoryCache`
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (2xx) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

```csharp
// –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
builder.Services.AddCachedAmoCrmClient(builder.Configuration);
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MemoryCache`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—É—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞ –ø–æ —à–∞–±–ª–æ–Ω–∞–º.
- –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏).
- –ú—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Ç.–¥.) –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è.

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –•—Ä–∞–Ω–∏—Ç–µ `ClientId`, `ClientSecret`, `ServerIntegrationAuthCode` –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, Azure Key Vault, AWS Secrets Manager) –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–ª—è–π—Ç–µ `refresh_token` —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é `AddAmoCrmClient()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö resilience patterns. –î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ CachedAmoCrmClient –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `Microsoft.Extensions.Logging` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è `TimeoutSeconds` –∏ `CacheExpiryMinutes` –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è `IAmoCrmClient` –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö.
5. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `ServerIntegrationSubdomain` –∏ `ServerIntegrationRedirectUri` –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞.
6. **Production**: –î–æ–≤–µ—Ä—å—Ç–µ—Å—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º resilience patterns –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å API.

### –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç resilience patterns —á–µ—Ä–µ–∑ `Reliable.HttpClient`:

```csharp
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—á–µ—Ä–µ–∑ AddResilience())
builder.Services.AddAmoCrmClient(builder.Configuration);
// –∏–ª–∏
builder.Services.AddCachedAmoCrmClient(builder.Configuration);
```

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ resilience patterns –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏)
- **Circuit breaker** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
- **Exponential backoff** —Å jitter –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ retry
